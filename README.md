## 概要

このプラグインは、kintone の一覧画面に複数フィールドを横断して検索できる UI を追加します。

テキストフィールド・ドロップダウン・添付ファイルを対象に、
AND / OR 条件で柔軟な検索を行うことができます。

単なる検索機能の追加ではなく、
運用中のフィールド構成変更によって検索が壊れないことを重視して設計しています。

---

## 特徴

### 🔍 複数フィールド横断検索
- テキスト（like）
- ドロップダウン（in）
- 添付ファイル（like）

### 🔗 AND / OR 条件対応
- 💾 設定時のフィールド構成をスナップショットとして保存
- ⚠️ フィールド定義変更を自動検知
- 不一致のフィールドは検索対象から自動除外
- 検索自体は継続可能

### 🛡 検索不能にならない安全設計
- 差分検知に失敗しても、設定時の条件でフォールバック

### なぜこの設計なのか

kintone では、運用中に以下のような変更が頻繁に起こります。
- フィールドタイプの変更
- ドロップダウン選択肢の追加・変更
- サブテーブル構成の調整

一般的な検索プラグインでは、
こうした変更があると 検索が動かなくなる / エラーになる ケースが少なくありません。

このプラグインでは、
- 設定時の意図（検索対象フィールド）をスナップショットとして保持
- 実行時に現在のフィールド定義と比較
- 不一致があれば警告しつつ、壊れない範囲で検索を継続
という方針を採用しています。

>※ 本プラグインは
「設定時の意図を尊重し、実行時に壊れないこと」 を最優先に設計されています。

---

## 仕組み（簡易）
1. プラグイン設定画面で検索対象フィールドを選択
2. 選択時点のフィールド定義をスナップショットとして保存
3. 一覧画面表示時に REST API で現在のフィールド定義を取得
4. スナップショットと比較
    - 一致 → 検索対象として使用
    - 不一致 → 検索対象から除外し警告表示
5. 検索クエリを生成し一覧に反映

### 対応フィールド
- フィールド種別	検索方法
- 文字列（1行 / 複数行）	like
- ドロップダウン	in（完全一致）
- 添付ファイル	like
- サブテーブル内フィールド	対応

>※ 数値・日付・チェックボックス等は現時点では対象外です。

---

## 使い方
1. プラグインをインストール
2. プラグイン設定画面を開く
3. 検索対象フィールドを選択
4. 一覧画面右上の検索ボックスから検索

検索語は URL パラメータ（nrc_q）として保持されるため、
ページ遷移後も検索語が維持されます。

---

## 注意事項・制限
- ドロップダウン検索は 選択肢の完全一致 のみ対象です
- フィールド定義の変更内容によっては、検索対象から自動除外されます
- 除外された場合は警告表示が出ますが、検索自体は継続されます
- 本プラグインは一覧画面専用です（詳細画面・編集画面では動作しません）

---

## 開発方針
- UX を壊さないことを最優先
- エラーよりも「安全なフォールバック」を重視
- 実運用で起こりうる変更を前提に設計

>このリポジトリは、
kintone プラグイン開発における堅牢設計の一例としても公開しています。

---

## ライセンス

MIT License
（自由に利用・改変していただいて構いません）

## 作者
GitHub: https://github.com/youtotto

kintone プラグイン開発者
